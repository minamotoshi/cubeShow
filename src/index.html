<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<title>手Q环境AR效果Demo</title>
</head>

<body>
	<div id="ar-loading">
		<div class="loadingbar"></div>
		<div class="percent">loading...</div>
	</div>
	<div id="ar-video" style="display:none">
		<video id="video" class="video" autoplay=""></video>
		<canvas id="canvas" style="position:absolute;left:0px;top:0px;"></canvas>
	</div>
	<div id="ar-webgl" style="display:none">
		<canvas id="ar-webgl-game"></canvas>
		<div class="info">
			<div class="arrow-left"><img src="./images/page/arrow.png"/></div>
			<div class="arrow-right"><img src="./images/page/arrow.png"/></div>
			<div class="tips"><img src="./images/page/tips.png"/></div>
		</div>
	</div>
	<div id="ar-create" style="display:none">
		<canvas id="ar-create-game" width="640" height="1042" style="width:100%;height:100%"></canvas>
		<div class="guide">
			<div class="slogan"><img src=""/></div>
			<div class="btn"><a href="#"><img src="./images/page/btn.png"/></a></div>
		</div>
		<div class="back-btn" style="display:none" ><img src="./images/page/back.png"/></div>
	</div>
	<script>
		
var _game = null,
	_cartoon = null,
	_guideListener = null;
window.addEventListener('load', function(e){
	CubeShow.Preload.load(progress, complete);
});
function progress(e){
	document.querySelector("#ar-loading .percent").innerHTML = Math.floor(e.loaded * 10000)/100 + "%";
}
function complete(){
	_game = new CubeShow.main(document.getElementById("ar-webgl-game"));
	_game.addEventListener(CubeShow.Event.CUBE_CLICK, onCubeClick);
	_cartoon = new CubeShow.Cartoon(document.getElementById("ar-create-game"));
	document.querySelector('#ar-create .back-btn').addEventListener("click", onback);	
	document.getElementById("ar-loading").style.display = "none";
	guide();
}
function guide(){
	document.getElementById("ar-create").style.display = "";
	document.querySelector('#ar-create .back-btn').style.display = 'none';
	document.querySelector('#ar-create .guide').style.display = 'none';
	document.getElementById('ar-webgl').style.display = 'none';
	_cartoon.play("LC");
	_guideListener = _cartoon.getChildAt(0).on("tick", onGuideTick);
}
function onGuideTick(e){
	let mc = e.target;
	if(mc.currentFrame >= mc.totalFrames){
		_cartoon.getChildAt(0).off("tick", _guideListener);
		launch();
	}
}
function launch(){
	document.getElementById("ar-create").style.display = "none";
	document.getElementById('ar-webgl').style.display = '';
	document.querySelector('#ar-create .back-btn').style.display = '';
	document.querySelector('#ar-create .guide').style.display = '';
	_game.launch();
}
function onback(){
	document.getElementById("ar-create").style.display = "none";
	document.getElementById('ar-webgl').style.display = '';
	_cartoon.clear();
	_game.replay()
}
function onCubeClick(e){
	let name = e.data.name;
	document.getElementById("ar-create").style.display = "";
	document.getElementById("ar-create-game").style.display = "";
	document.getElementById('ar-webgl').style.display = 'none';
	document.querySelector("#ar-create .guide .slogan img").src = "images/" + name + "-slogan.png";
	if(name == "Jeans"){
		_game.paper();
		document.getElementById('ar-webgl').style.display = '';
		document.getElementById("ar-create-game").style.display = "none";
	}else{
		_cartoon.play(name);
	}
}
	</script>
</body>

</html>
